<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gdutdb.carsales.mapper.CarMapper">

    <resultMap id="BaseResultMap" type="com.gdutdb.carsales.po.poja.Car">
        <id property="carVin" column="car_vin" jdbcType="INTEGER"/>
        <result property="carDistributorId" column="car_distributor_id" jdbcType="INTEGER"/>
        <result property="carModelId" column="car_model_id" jdbcType="INTEGER"/>
        <result property="enable" column="enable" jdbcType="BOOLEAN"/>
    </resultMap>

    <sql id="Base_Column_List">
        car_vin,car_distributor_id,car_model_id,enable
    </sql>



    <resultMap id="CarDetailMap" type="com.gdutdb.carsales.po.dto.CarDetail">
        <id property="carVin" column="car_vin" jdbcType="INTEGER"/>
        <result property="carDistributorId" column="car_distributor_id" jdbcType="INTEGER"/>
        <result property="carModelId" column="car_model_id" jdbcType="INTEGER"/>
        <result property="enable" column="enable" jdbcType="BOOLEAN"/>

        <result property="brand.brandId" column="brand_id" jdbcType="INTEGER"/>
        <result property="brand.brandName" column="brand_name" jdbcType="VARCHAR"/>
        <result property="brand.enable" column="enable" jdbcType="BOOLEAN"/>
    </resultMap>


    <select id="queryAllByEnable">
        SELECT *
        FROM car
            LEFT JOIN model m on car_model_id = m.model_id
        WHERE car.enable
    </select>

    <select id="queryByModelId" parameterType="integer">
        SELECT *
        FROM car
             LEFT JOIN model m on car_model_id = m.model_id
        WHERE car.enable AND car.car_model_id = #modelId
    </select>

    <select id="queryByDistributorId" parameterType="integer">
        SELECT *
        FROM car
                 LEFT JOIN model m on car_model_id = m.model_id
        WHERE car.enable AND car.car_distributor_id = #distributorId
    </select>

    <select id="queryByDistributorIdAndBrandId" parameterType="integer">
        SELECT *
        FROM car
                 LEFT JOIN model m on car_model_id = m.model_id
        WHERE car.enable
          AND car.car_distributor_id = #distributorId
          AND car.car_model_id = #modelId
    </select>

    <select id="queryOptionOfCar" parameterType="integer" resultMap="com.gdutdb.carsales.mapper.OptionMapper.BaseResultMap">
        SELECT *
        FROM `car_option`
                 LEFT JOIN `option` o on o.option_id = car_option.option_id
        WHERE car_vin = #carVin
    </select>

    <update id="deleteByCarVin" parameterType="integer">
        UPDATE car
        SET car.enable = false
        WHERE car.car_vin = #carVin
    </update>
</mapper>
